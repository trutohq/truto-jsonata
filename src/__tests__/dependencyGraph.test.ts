import { describe, expect, it } from 'vitest'
import dependencyGraph from '../functions/dependencyGraph'

const data = [
  {
    id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    sequence: 0,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '\nTabular values as CSV\n',
    has_children: true,
  },
  {
    id: 'ced0bc9e-54a5-4d59-a076-443c3d4487c2',
    sequence: 1,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '## Implementer’s note\n',
    has_children: false,
  },
  {
    id: '69beb302-f4da-46f9-b205-ec868d9b83ae',
    sequence: 2,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content:
      '\nThe User Management API is available for Premium/Enterprise customers.\n',
    has_children: false,
  },
  {
    id: '4dad3eb4-c34b-4a04-ac84-79c1bb2c0f8e',
    sequence: 3,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '\n\n',
    has_children: false,
  },
  {
    id: 'fc66daa7-4b72-43f9-846e-dc9ce44594f7',
    sequence: 4,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '### OAuth Scopes\n',
    has_children: false,
  },
  {
    id: '26f7dad3-3160-4704-b231-a3f2e99a6ada',
    sequence: 5,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '\n\n',
    has_children: false,
  },
  {
    id: '0d61f34e-406f-4639-b551-eb0745631ec8',
    sequence: 6,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '## Pre-prod Checklist\n',
    has_children: false,
  },
  {
    id: '91156e7d-83e7-494c-9b1b-30e32e9ad0ad',
    sequence: 7,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content:
      '- [X] OAuth app can be installed by all end-users of the underlying product\n',
    has_children: true,
  },
  {
    id: '0d8691c9-e5fc-4f09-8702-6912be3e2d6e',
    sequence: 8,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Checked OAuth scope override\n',
    has_children: true,
  },
  {
    id: '919806c2-510c-42cd-b9bf-15a64333f27f',
    sequence: 9,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content:
      '- [X] No hardcoded subdomains, URLs and Query parameters. E.g. A base URL like [truto.freshdesk.com](http://truto.freshdesk.com/) should be moved to a variable like {{subdomain}}.freshdesk.com.\n',
    has_children: false,
  },
  {
    id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    sequence: 10,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Check pagination for all routes.\n',
    has_children: true,
  },
  {
    id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    sequence: 11,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Rate limits\n',
    has_children: true,
  },
  {
    id: 'dd3103d4-dfef-4fba-b406-780a429712b9',
    sequence: 12,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content:
      '- [X] Does the integration follow proper status codes for errors?\n',
    has_children: true,
  },
  {
    id: '56137129-a6bb-4f25-b6ad-cd53c6c0f734',
    sequence: 13,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Added User-Agent, Accepts and Content-Type headers\n',
    has_children: false,
  },
  {
    id: '2cd25991-4652-4973-ab71-59c70b0304ba',
    sequence: 14,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Added Logo\n',
    has_children: false,
  },
  {
    id: '44eda9e3-56fb-493b-a101-726b041bc539',
    sequence: 15,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Added Icon\n',
    has_children: false,
  },
  {
    id: '39b42dd5-b6f7-4d55-b113-0a9655afb3fb',
    sequence: 16,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Set the sharing to Public\n',
    has_children: false,
  },
  {
    id: '3db295a4-c387-41c0-883d-153c2005f23a',
    sequence: 17,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Refresh access token flow\n',
    has_children: true,
  },
  {
    id: '99bf5c1e-70b2-4643-92f7-8b698ddd1903',
    sequence: 18,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content:
      '- [X] Updated integrations roster [https://docs.google.com/spreadsheets/d/1mGjrVKLXxQ5kUFcvzjO0rxjo2FlnJtA63pp-IIVWHgM/edit#gid=0](https://docs.google.com/spreadsheets/d/1mGjrVKLXxQ5kUFcvzjO0rxjo2FlnJtA63pp-IIVWHgM/edit#gid=0)\n',
    has_children: false,
  },
  {
    id: 'aaa9b485-fb42-4d65-ba78-ded48c25d558',
    sequence: 19,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Notified the relevant customer\n',
    has_children: true,
  },
  {
    id: '4ba7fd8f-2720-44d1-858d-babcefdf588f',
    sequence: 20,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Checked query array format\n',
    has_children: true,
  },
  {
    id: '603961c5-f180-4641-b23c-1ea3b23dc225',
    sequence: 21,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Added Label post action\n',
    has_children: true,
  },
  {
    id: 'a470a006-eb45-44e6-9f8c-1fc11678ec3d',
    sequence: 22,
    parent_id: '84acd72f-5935-499b-954f-7a5a560f9b3c',
    content: '- [X] Posted in #integrations channel in Truto\n',
    has_children: false,
  },
  {
    id: '504b7707-da46-4caf-b6cd-8b9ad748c158',
    sequence: 0,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content:
      '\nDocumentation URL,https://www.contentful.com/developers/docs/references/content-management-api/#/reference/spaces/spaces-collection\n',
    has_children: false,
  },
  {
    id: '72f3175a-43d3-47f9-ab60-3bb119cc3584',
    sequence: 1,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nHas open signup?,Yes\n',
    has_children: false,
  },
  {
    id: '318296ce-c701-4130-adb0-e9872df509b9',
    sequence: 2,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nTrial duration,NA\n',
    has_children: false,
  },
  {
    id: 'c508af91-7b31-46f5-b2df-1fee2dec0ec0',
    sequence: 3,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nSignup URL,https://www.contentful.com/sign-up/\n',
    has_children: false,
  },
  {
    id: 'f6e0714b-4bcd-406a-8e57-a723e7040d7b',
    sequence: 4,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nAuthentication formats supported,API Key\n',
    has_children: false,
  },
  {
    id: '4fc563b4-2a73-4110-8870-d7bca5b96453',
    sequence: 5,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nIf OAuth, supports scope override?,No\n',
    has_children: false,
  },
  {
    id: 'eeafb82e-504f-47e4-8ad2-c798e3ab8315',
    sequence: 6,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nOAuth app needs verification,NA\n',
    has_children: false,
  },
  {
    id: '23a1d2b2-a748-4c54-b2c5-000794c7f109',
    sequence: 7,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nAuthentication formats in Truto,API Key\n',
    has_children: false,
  },
  {
    id: 'ea0c5754-e19f-4448-bc0a-c0e5f10b7afa',
    sequence: 8,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nLive on Truto,Yes\n',
    has_children: false,
  },
  {
    id: 'c5ec1fc4-bd99-41c2-b81e-8317b9e10ecf',
    sequence: 9,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nTested by Truto,Yes ( Organizations), No (Users)\n',
    has_children: false,
  },
  {
    id: '025a1c6b-6f85-482a-8012-f8487671bfc2',
    sequence: 10,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nIntegration guide link,\n',
    has_children: false,
  },
  {
    id: '42afac94-7d82-4d85-88f5-d290a6f38836',
    sequence: 11,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nAPI Type,REST\n',
    has_children: false,
  },
  {
    id: 'aef2d732-e597-4a03-b46c-a1aea708736e',
    sequence: 12,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content: '\nUnified APIs supported,User Directory\n',
    has_children: false,
  },
  {
    id: '10d6c11f-634b-4540-8f72-e4c60bc1ec06',
    sequence: 13,
    parent_id: 'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
    content:
      '\nIntegrated account in Truto,606549c6-97ae-452e-98bd-08837072ffbc\n',
    has_children: false,
  },
  {
    id: '08b58454-b361-445b-9930-85e58d0a3260',
    sequence: 0,
    parent_id: '91156e7d-83e7-494c-9b1b-30e32e9ad0ad',
    content: '- [X] NA\n',
    has_children: false,
  },
  {
    id: 'd4f78795-496c-4616-9b34-f200c0ce6df3',
    sequence: 1,
    parent_id: '91156e7d-83e7-494c-9b1b-30e32e9ad0ad',
    content: '- [ ] Needs verification\n',
    has_children: true,
  },
  {
    id: '9d5baebf-f8a4-4c33-95eb-08033613072d',
    sequence: 2,
    parent_id: '91156e7d-83e7-494c-9b1b-30e32e9ad0ad',
    content:
      '- [ ] Can’t provide OAuth app for all Truto customers, they’ll need to create their own\n',
    has_children: true,
  },
  {
    id: '4a6b753f-ca68-44ef-9b0c-a7a077c9f53d',
    sequence: 0,
    parent_id: '0d8691c9-e5fc-4f09-8702-6912be3e2d6e',
    content: '- [X] NA — If authentication is not OAuth\n',
    has_children: false,
  },
  {
    id: '1c48db56-fbdd-4924-87a7-b58e58327826',
    sequence: 1,
    parent_id: '0d8691c9-e5fc-4f09-8702-6912be3e2d6e',
    content: '- [ ] Supported\n',
    has_children: false,
  },
  {
    id: '0b9d9562-b4ce-4e94-bb4b-204497affb07',
    sequence: 2,
    parent_id: '0d8691c9-e5fc-4f09-8702-6912be3e2d6e',
    content: '- [ ] Not supported\n',
    has_children: false,
  },
  {
    id: '6b3c4c68-9ecf-47bd-ab9e-36fcc8f886ea',
    sequence: 0,
    parent_id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    content: '- [ ] NA\n',
    has_children: false,
  },
  {
    id: 'e5bfc40b-9098-4fc6-a57a-b0a33b3157b7',
    sequence: 1,
    parent_id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    content: '- [ ] Not tested because — reason here\n',
    has_children: false,
  },
  {
    id: '919a5886-337c-4e56-b6e1-d4f391cdba4c',
    sequence: 2,
    parent_id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    content: '- [X] Works with no limit\n',
    has_children: false,
  },
  {
    id: '2ecc02b8-6220-4165-9508-f9f9d032e469',
    sequence: 3,
    parent_id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    content: '- [X] Works with limit\n',
    has_children: false,
  },
  {
    id: 'e9eb3412-ac57-46e7-b861-ab9a6e341ee0',
    sequence: 4,
    parent_id: '6e938956-82fe-449f-b5da-668fa4a24db7',
    content: '- [X] Works with next_cursor\n',
    has_children: false,
  },
  {
    id: '6c3473e5-8668-4c69-954c-0fd213cf63d4',
    sequence: 0,
    parent_id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    content: '- [ ] NA\n',
    has_children: false,
  },
  {
    id: '3e4d71a4-a7fb-44de-b6ef-761434e9324d',
    sequence: 1,
    parent_id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    content: '- [ ] Not tested because — reason here\n',
    has_children: false,
  },
  {
    id: 'df167d1f-edb1-44e0-b9d8-9279112c6489',
    sequence: 2,
    parent_id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    content: '- [X] Supports Limit\n',
    has_children: false,
  },
  {
    id: '6a24dfd4-5c17-4bb5-8858-6640bdecdc54',
    sequence: 3,
    parent_id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    content: '- [X] Supports Remaining\n',
    has_children: false,
  },
  {
    id: '90122102-274c-4b3c-8730-732f895e255e',
    sequence: 4,
    parent_id: 'b7187fff-a2a4-4de1-b057-9367dff65ef1',
    content: '- [X] Supports Reset\n',
    has_children: false,
  },
  {
    id: '496636f4-9e5d-45d8-b102-920a567fb07f',
    sequence: 0,
    parent_id: 'dd3103d4-dfef-4fba-b406-780a429712b9',
    content: '- [X] Yes\n',
    has_children: false,
  },
  {
    id: '32297509-e4d9-4421-a581-7cdec572852d',
    sequence: 1,
    parent_id: 'dd3103d4-dfef-4fba-b406-780a429712b9',
    content: '- [ ] Sends 200 for everything. Added the error expression\n',
    has_children: false,
  },
  {
    id: 'c5339c75-565f-4e50-b4ba-6795c66176ce',
    sequence: 0,
    parent_id: '3db295a4-c387-41c0-883d-153c2005f23a',
    content: '- [X] NA\n',
    has_children: false,
  },
  {
    id: '075b422f-1e82-49fd-9c45-6d21a614b5fa',
    sequence: 1,
    parent_id: '3db295a4-c387-41c0-883d-153c2005f23a',
    content: '- [ ] Not tested because — reason here\n',
    has_children: false,
  },
  {
    id: '382922de-6e47-413e-a422-71332e13aab2',
    sequence: 2,
    parent_id: '3db295a4-c387-41c0-883d-153c2005f23a',
    content: '- [ ] Works\n',
    has_children: false,
  },
  {
    id: '70610722-7ea2-4e3a-8614-3701ea39d7ca',
    sequence: 0,
    parent_id: 'aaa9b485-fb42-4d65-ba78-ded48c25d558',
    content: '- [ ] NA\n',
    has_children: false,
  },
  {
    id: 'f6cd3b82-0f43-4689-bffa-c33dc8b60cd6',
    sequence: 1,
    parent_id: 'aaa9b485-fb42-4d65-ba78-ded48c25d558',
    content: '- [ ] Waiting on Unified API\n',
    has_children: false,
  },
  {
    id: '38bb2a4c-5aaa-4b94-9cc6-c76283703c5d',
    sequence: 0,
    parent_id: '4ba7fd8f-2720-44d1-858d-babcefdf588f',
    content: '- [X] NA\n',
    has_children: false,
  },
  {
    id: 'a96f48f8-fc46-46f5-9b69-5b09f5953a02',
    sequence: 1,
    parent_id: '4ba7fd8f-2720-44d1-858d-babcefdf588f',
    content: '- [ ] Not tested because — reason here\n',
    has_children: false,
  },
  {
    id: '6d1767fc-2bef-4fe4-93c6-55974c5858fb',
    sequence: 0,
    parent_id: '603961c5-f180-4641-b23c-1ea3b23dc225',
    content: '- [ ] NA\n',
    has_children: false,
  },
  {
    id: 'f545d4a2-e41f-4489-b6e5-9174480a8f28',
    sequence: 1,
    parent_id: '603961c5-f180-4641-b23c-1ea3b23dc225',
    content: '- [ ] Not tested because — reason here\n',
    has_children: false,
  },
  {
    id: 'b325a8d8-43ba-4e44-b41d-b8c91e1dc378',
    sequence: 0,
    parent_id: 'd4f78795-496c-4616-9b34-f200c0ce6df3',
    content: '- [ ] Verification Done\n',
    has_children: false,
  },
  {
    id: 'a0819bb0-41fe-4260-9421-38d703ff993c',
    sequence: 0,
    parent_id: '9d5baebf-f8a4-4c33-95eb-08033613072d',
    content:
      '- [ ] Set the client_id and client_secret to “dummy” in the integration\n',
    has_children: false,
  },
]
describe('dependencyGraph', () => {
  it('should construct graph', () => {
    const graph = dependencyGraph(data, 'parent_id', 'id')
    expect(graph.overallOrder(true)).toEqual([
      'ced0bc9e-54a5-4d59-a076-443c3d4487c2',
      '69beb302-f4da-46f9-b205-ec868d9b83ae',
      '4dad3eb4-c34b-4a04-ac84-79c1bb2c0f8e',
      'fc66daa7-4b72-43f9-846e-dc9ce44594f7',
      '26f7dad3-3160-4704-b231-a3f2e99a6ada',
      '0d61f34e-406f-4639-b551-eb0745631ec8',
      '919806c2-510c-42cd-b9bf-15a64333f27f',
      '56137129-a6bb-4f25-b6ad-cd53c6c0f734',
      '2cd25991-4652-4973-ab71-59c70b0304ba',
      '44eda9e3-56fb-493b-a101-726b041bc539',
      '39b42dd5-b6f7-4d55-b113-0a9655afb3fb',
      '99bf5c1e-70b2-4643-92f7-8b698ddd1903',
      'a470a006-eb45-44e6-9f8c-1fc11678ec3d',
      'f18c2d60-79b9-49d2-b74b-cd04d68ff0fc',
      '91156e7d-83e7-494c-9b1b-30e32e9ad0ad',
      '0d8691c9-e5fc-4f09-8702-6912be3e2d6e',
      '6e938956-82fe-449f-b5da-668fa4a24db7',
      'b7187fff-a2a4-4de1-b057-9367dff65ef1',
      'dd3103d4-dfef-4fba-b406-780a429712b9',
      '3db295a4-c387-41c0-883d-153c2005f23a',
      'aaa9b485-fb42-4d65-ba78-ded48c25d558',
      '4ba7fd8f-2720-44d1-858d-babcefdf588f',
      '603961c5-f180-4641-b23c-1ea3b23dc225',
    ])
  })
})
